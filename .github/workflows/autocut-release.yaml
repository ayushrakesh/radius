name: Auto-release tag

on:
  schedule:
    # Every four Wednesdays at midnight Pacific Time (UTC-7)
    - at: '2023-05-24T00:00:00-07:00'
    - at: '2023-06-21T00:00:00-07:00'
    - at: '2023-07-19T00:00:00-07:00'
    - at: '2023-08-16T00:00:00-07:00'
    - at: '2023-09-13T00:00:00-07:00'
    - at: '2023-10-11T00:00:00-07:00'
    - at: '2023-11-08T00:00:00-08:00'
    - at: '2023-12-06T00:00:00-08:00'
    - at: '2024-01-03T00:00:00-08:00'
    - at: '2024-01-31T00:00:00-08:00'
    - at: '2024-02-28T00:00:00-08:00'
    - at: '2024-03-27T00:00:00-07:00'
    - at: '2024-04-24T00:00:00-07:00'
    - at: '2024-05-22T00:00:00-07:00'
    - at: '2024-06-19T00:00:00-07:00'
    - at: '2024-07-17T00:00:00-07:00'
    - at: '2024-08-14T00:00:00-07:00'
    - at: '2024-09-11T00:00:00-07:00'
    - at: '2024-10-09T00:00:00-07:00'
    - at: '2024-11-06T00:00:00-08:00'
    - at: '2024-12-04T00:00:00-08:00'
    - at: '2025-01-01T00:00:00-08:00'
    - at: '2025-01-29T00:00:00-08:00'
    - at: '2025-02-26T00:00:00-08:00'
    - at: '2025-03-26T00:00:00-07:00'
    - at: '2025-04-23T00:00:00-07:00'
    - at: '2025-05-21T00:00:00-07:00'
    - at: '2025-06-18T00:00:00-07:00'
    - at: '2025-07-16T00:00:00-07:00'
    - at: '2025-08-13T00:00:00-07:00'
    - at: '2025-09-10T00:00:00-07:00'
    - at: '2025-10-08T00:00:00-07:00'
    - at: '2025-11-05T00:00:00-08:00'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Get latest tag
        id: get_tag
        run: echo ::set-output name=tag::$(git describe --abbrev=0)

      - name: Create new tag
        id: create_tag
        if: ${{ github.event.schedule.repository_full_name == github.repository }}
        run: |
          OLD_TAG=${{ steps.get_tag.outputs.tag }}
          NEW_TAG=$(echo $OLD_TAG | awk -F'[ .]' '{if ($2 == 99) printf "v%02d.%02d", $1+1, 00; else printf "v%02d.%02d", $1, ($2+1)%100}')
          git tag $NEW_TAG
          git push origin $NEW_TAG
